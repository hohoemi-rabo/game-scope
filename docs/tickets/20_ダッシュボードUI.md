# ãƒã‚±ãƒƒãƒˆ #20: ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰UI

## ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹: [æœªç€æ‰‹]

## æ¦‚è¦

ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®ã‚²ãƒ¼ãƒ ãƒãƒ¼ãƒˆãƒ•ã‚©ãƒªã‚ªã‚’è¡¨ç¤ºã™ã‚‹ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ãƒšãƒ¼ã‚¸ã‚’å®Ÿè£…ã™ã‚‹ã€‚ã‚µãƒãƒªãƒ¼ï¼ˆç·æŠ•è³‡é¡ã€ç·ãƒ—ãƒ¬ã‚¤æ™‚é–“ã€å¹³å‡CPHï¼‰ã¨ã‚²ãƒ¼ãƒ ãƒªã‚¹ãƒˆã‚’è¡¨ç¤ºã€‚

## èƒŒæ™¯

- ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒè‡ªåˆ†ã®ã‚²ãƒ¼ãƒ æŠ•è³‡çŠ¶æ³ã‚’ä¸€ç›®ã§æŠŠæ¡ã§ãã‚‹
- CPHï¼ˆCost Per Hourï¼‰ã§ã‚³ã‚¹ãƒ‘ã‚’å¯è¦–åŒ–
- ã‚³ã‚¹ãƒ‘ãƒ©ãƒ³ã‚¯ãƒãƒƒã‚¸ã§é”æˆæ„Ÿã‚’æ¼”å‡º

## ä½œæ¥­å†…å®¹

### 1. ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ãƒšãƒ¼ã‚¸

- [ ] `/dashboard` ãƒšãƒ¼ã‚¸ä½œæˆ
- [ ] èªè¨¼ãƒã‚§ãƒƒã‚¯ï¼ˆæœªãƒ­ã‚°ã‚¤ãƒ³ã¯ãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆï¼‰
- [ ] ãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒ‡ãƒ¼ã‚¿å–å¾—

### 2. ã‚µãƒãƒªãƒ¼ã‚«ãƒ¼ãƒ‰

- [ ] ç·æŠ•è³‡é¡è¡¨ç¤º
- [ ] ç·ãƒ—ãƒ¬ã‚¤æ™‚é–“è¡¨ç¤º
- [ ] å¹³å‡CPHè¡¨ç¤º + ãƒ©ãƒ³ã‚¯ãƒãƒƒã‚¸

### 3. ã‚²ãƒ¼ãƒ ãƒªã‚¹ãƒˆ

- [ ] ç™»éŒ²ã‚²ãƒ¼ãƒ ä¸€è¦§è¡¨ç¤º
- [ ] å„ã‚²ãƒ¼ãƒ ã®CPH + ãƒ©ãƒ³ã‚¯ãƒãƒƒã‚¸
- [ ] ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹è¡¨ç¤º
- [ ] ç·¨é›†ãƒ»å‰Šé™¤ãƒœã‚¿ãƒ³

### 4. CPHè¨ˆç®—ãƒ­ã‚¸ãƒƒã‚¯

- [ ] CPHè¨ˆç®—é–¢æ•°ã®å®Ÿè£…
- [ ] ã‚³ã‚¹ãƒ‘ãƒ©ãƒ³ã‚¯åˆ¤å®šé–¢æ•°
- [ ] ãƒ©ãƒ³ã‚¯ãƒãƒƒã‚¸ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ

## æŠ€è¡“ä»•æ§˜

### ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ãƒšãƒ¼ã‚¸

```typescript
// src/app/dashboard/page.tsx
import { redirect } from 'next/navigation'
import { createClient } from '@/lib/supabase/server'
import Container from '@/app/components/Container'
import DashboardSummary from '@/app/components/dashboard/DashboardSummary'
import GameList from '@/app/components/dashboard/GameList'
import AddGameButton from '@/app/components/dashboard/AddGameButton'

export default async function DashboardPage() {
  const supabase = createClient()

  // èªè¨¼ãƒã‚§ãƒƒã‚¯
  const { data: { user } } = await supabase.auth.getUser()

  if (!user) {
    redirect('/login')
  }

  // ãƒãƒ¼ãƒˆãƒ•ã‚©ãƒªã‚ªãƒ‡ãƒ¼ã‚¿å–å¾—
  const { data: portfolios } = await supabase
    .from('user_portfolios')
    .select(`
      *,
      games (
        id,
        title_ja,
        title_en,
        thumbnail_url,
        metascore
      )
    `)
    .eq('user_id', user.id)
    .order('updated_at', { ascending: false })

  return (
    <Container className="py-8">
      <header className="flex items-center justify-between mb-8">
        <h1 className="text-3xl font-bold">ğŸ“Š ãƒã‚¤ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰</h1>
        <AddGameButton />
      </header>

      <DashboardSummary portfolios={portfolios || []} />

      <section className="mt-10">
        <h2 className="text-xl font-bold mb-4">ç™»éŒ²ã‚²ãƒ¼ãƒ ä¸€è¦§</h2>
        <GameList portfolios={portfolios || []} />
      </section>
    </Container>
  )
}
```

### CPHè¨ˆç®—ãƒ­ã‚¸ãƒƒã‚¯

```typescript
// src/lib/utils/cph.ts

export interface CPHResult {
  cph: number | null
  rank: CPHRank
}

export type CPHRank = 'god' | 'gold' | 'silver' | 'bronze' | 'luxury' | 'free' | 'unplayed'

export interface RankInfo {
  rank: CPHRank
  label: string
  emoji: string
  color: string
  message: string
}

export const RANK_INFO: Record<CPHRank, RankInfo> = {
  god: {
    rank: 'god',
    label: 'God Tier',
    emoji: 'ğŸ’',
    color: 'text-cyan-400',
    message: 'å®Ÿè³ªç„¡æ–™',
  },
  gold: {
    rank: 'gold',
    label: 'Gold Tier',
    emoji: 'ğŸ¥‡',
    color: 'text-yellow-400',
    message: 'è¶…å„ªè‰¯æŠ•è³‡',
  },
  silver: {
    rank: 'silver',
    label: 'Silver Tier',
    emoji: 'ğŸ¥ˆ',
    color: 'text-gray-300',
    message: 'æ˜ ç”»é¤¨ã‚ˆã‚Šå®‰ã„',
  },
  bronze: {
    rank: 'bronze',
    label: 'Bronze Tier',
    emoji: 'ğŸ¥‰',
    color: 'text-orange-400',
    message: 'é©æ­£ä¾¡æ ¼',
  },
  luxury: {
    rank: 'luxury',
    label: 'Luxury',
    emoji: 'ğŸ’¸',
    color: 'text-pink-400',
    message: 'è´…æ²¢ãªéŠã³',
  },
  free: {
    rank: 'free',
    label: 'Free',
    emoji: 'ğŸ',
    color: 'text-green-400',
    message: 'ã‚µãƒ–ã‚¹ã‚¯/ç„¡æ–™',
  },
  unplayed: {
    rank: 'unplayed',
    label: 'Unplayed',
    emoji: 'ğŸ“š',
    color: 'text-text-secondary',
    message: 'æœªãƒ—ãƒ¬ã‚¤',
  },
}

export function calculateCPH(
  purchasePrice: number,
  playTimeMinutes: number,
  isSubscription: boolean
): CPHResult {
  // ã‚µãƒ–ã‚¹ã‚¯/ç„¡æ–™ã®å ´åˆ
  if (isSubscription || purchasePrice === 0) {
    return { cph: 0, rank: 'free' }
  }

  // æœªãƒ—ãƒ¬ã‚¤ã®å ´åˆ
  if (playTimeMinutes === 0) {
    return { cph: null, rank: 'unplayed' }
  }

  // é€šå¸¸è¨ˆç®—
  const playTimeHours = playTimeMinutes / 60
  const cph = Math.round(purchasePrice / playTimeHours)

  // ãƒ©ãƒ³ã‚¯åˆ¤å®š
  let rank: CPHRank
  if (cph <= 50) {
    rank = 'god'
  } else if (cph <= 200) {
    rank = 'gold'
  } else if (cph <= 500) {
    rank = 'silver'
  } else if (cph <= 1500) {
    rank = 'bronze'
  } else {
    rank = 'luxury'
  }

  return { cph, rank }
}

// å¹³å‡CPHã‚’è¨ˆç®—
export function calculateAverageCPH(
  portfolios: Array<{
    purchase_price: number
    play_time_minutes: number
    is_subscription: boolean
  }>
): CPHResult {
  const validEntries = portfolios.filter(
    (p) => !p.is_subscription && p.purchase_price > 0 && p.play_time_minutes > 0
  )

  if (validEntries.length === 0) {
    return { cph: null, rank: 'unplayed' }
  }

  const totalPrice = validEntries.reduce((sum, p) => sum + p.purchase_price, 0)
  const totalMinutes = validEntries.reduce((sum, p) => sum + p.play_time_minutes, 0)

  return calculateCPH(totalPrice, totalMinutes, false)
}
```

### ã‚µãƒãƒªãƒ¼ã‚«ãƒ¼ãƒ‰

```typescript
// src/app/components/dashboard/DashboardSummary.tsx
'use client'

import { calculateAverageCPH, RANK_INFO } from '@/lib/utils/cph'
import type { PortfolioWithGame } from '@/types/portfolio'

interface DashboardSummaryProps {
  portfolios: PortfolioWithGame[]
}

export default function DashboardSummary({ portfolios }: DashboardSummaryProps) {
  // é›†è¨ˆ
  const totalInvestment = portfolios.reduce((sum, p) => sum + p.purchase_price, 0)
  const totalMinutes = portfolios.reduce((sum, p) => sum + p.play_time_minutes, 0)
  const totalHours = Math.round(totalMinutes / 60)

  const averageCPH = calculateAverageCPH(portfolios)
  const rankInfo = RANK_INFO[averageCPH.rank]

  return (
    <div className="grid grid-cols-1 md:grid-cols-3 gap-4">
      {/* ç·æŠ•è³‡é¡ */}
      <div className="bg-gray-900/50 border border-gray-800 rounded-xl p-6">
        <div className="flex items-center gap-2 text-text-secondary mb-2">
          <span>ğŸ’°</span>
          <span className="text-sm">ç·æŠ•è³‡é¡</span>
        </div>
        <div className="text-3xl font-bold text-text-primary">
          Â¥{totalInvestment.toLocaleString()}
        </div>
      </div>

      {/* ç·ãƒ—ãƒ¬ã‚¤æ™‚é–“ */}
      <div className="bg-gray-900/50 border border-gray-800 rounded-xl p-6">
        <div className="flex items-center gap-2 text-text-secondary mb-2">
          <span>â±ï¸</span>
          <span className="text-sm">ç·ãƒ—ãƒ¬ã‚¤æ™‚é–“</span>
        </div>
        <div className="text-3xl font-bold text-text-primary">
          {totalHours.toLocaleString()}æ™‚é–“
        </div>
      </div>

      {/* å¹³å‡CPH */}
      <div className="bg-gray-900/50 border border-gray-800 rounded-xl p-6">
        <div className="flex items-center gap-2 text-text-secondary mb-2">
          <span>ğŸ“ˆ</span>
          <span className="text-sm">å¹³å‡CPH</span>
        </div>
        <div className="text-3xl font-bold text-text-primary">
          {averageCPH.cph !== null ? (
            <>Â¥{averageCPH.cph.toLocaleString()}/æ™‚é–“</>
          ) : (
            <span className="text-text-secondary">-</span>
          )}
        </div>
        <div className={`flex items-center gap-1 mt-2 ${rankInfo.color}`}>
          <span>{rankInfo.emoji}</span>
          <span className="text-sm font-medium">{rankInfo.label}</span>
        </div>
      </div>
    </div>
  )
}
```

### ã‚²ãƒ¼ãƒ ãƒªã‚¹ãƒˆã‚¢ã‚¤ãƒ†ãƒ 

```typescript
// src/app/components/dashboard/GameListItem.tsx
'use client'

import { calculateCPH, RANK_INFO } from '@/lib/utils/cph'
import type { PortfolioWithGame } from '@/types/portfolio'

interface GameListItemProps {
  portfolio: PortfolioWithGame
  onEdit: () => void
  onDelete: () => void
}

const STATUS_DISPLAY = {
  playing: { emoji: 'ğŸ®', label: 'Playing' },
  completed: { emoji: 'âœ…', label: 'Completed' },
  dropped: { emoji: 'âŒ', label: 'Dropped' },
  backlog: { emoji: 'ğŸ“š', label: 'Backlog' },
}

export default function GameListItem({ portfolio, onEdit, onDelete }: GameListItemProps) {
  const game = portfolio.games
  const { cph, rank } = calculateCPH(
    portfolio.purchase_price,
    portfolio.play_time_minutes,
    portfolio.is_subscription
  )
  const rankInfo = RANK_INFO[rank]
  const statusInfo = STATUS_DISPLAY[portfolio.status as keyof typeof STATUS_DISPLAY]

  return (
    <div className="flex items-center gap-4 p-4 bg-gray-900/50 border border-gray-800 rounded-xl">
      {/* ã‚µãƒ ãƒã‚¤ãƒ« */}
      {game.thumbnail_url && (
        <img
          src={game.thumbnail_url}
          alt={game.title_ja || game.title_en}
          className="w-20 h-12 object-cover rounded"
        />
      )}

      {/* ã‚²ãƒ¼ãƒ æƒ…å ± */}
      <div className="flex-1 min-w-0">
        <h3 className="font-bold text-text-primary truncate">
          {game.title_ja || game.title_en}
        </h3>
        <div className="flex items-center gap-4 text-sm text-text-secondary mt-1">
          {/* CPH + ãƒ©ãƒ³ã‚¯ */}
          <span className={`flex items-center gap-1 ${rankInfo.color}`}>
            <span>{rankInfo.emoji}</span>
            {cph !== null ? (
              <span>Â¥{cph.toLocaleString()}/æ™‚é–“</span>
            ) : (
              <span>{rankInfo.message}</span>
            )}
          </span>

          {/* ãƒ—ãƒ¬ã‚¤æ™‚é–“ */}
          <span>{Math.round(portfolio.play_time_minutes / 60)}æ™‚é–“</span>

          {/* è³¼å…¥é‡‘é¡ */}
          <span>
            {portfolio.is_subscription ? 'ã‚µãƒ–ã‚¹ã‚¯' : `Â¥${portfolio.purchase_price.toLocaleString()}`}
          </span>
        </div>
      </div>

      {/* ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ */}
      <div className="flex items-center gap-1 text-sm text-text-secondary">
        <span>{statusInfo.emoji}</span>
        <span>{statusInfo.label}</span>
      </div>

      {/* ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ */}
      <div className="flex items-center gap-2">
        <button
          onClick={onEdit}
          className="p-2 text-text-secondary hover:text-text-primary
                     hover:bg-gray-800 rounded-lg transition-colors"
          title="ç·¨é›†"
        >
          âœï¸
        </button>
        <button
          onClick={onDelete}
          className="p-2 text-text-secondary hover:text-danger
                     hover:bg-gray-800 rounded-lg transition-colors"
          title="å‰Šé™¤"
        >
          ğŸ—‘ï¸
        </button>
      </div>
    </div>
  )
}
```

### ã‚³ã‚¹ãƒ‘ãƒ©ãƒ³ã‚¯å®šç¾©

| ãƒ©ãƒ³ã‚¯         | æ¡ä»¶ï¼ˆCPHï¼‰       | çµµæ–‡å­— | ã‚«ãƒ©ãƒ¼      | ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸     |
| -------------- | ----------------- | ------ | ----------- | -------------- |
| ğŸ’ God Tier    | 0 å†† ã€œ 50 å††     | ğŸ’     | cyan-400    | å®Ÿè³ªç„¡æ–™       |
| ğŸ¥‡ Gold Tier   | 51 å†† ã€œ 200 å††   | ğŸ¥‡     | yellow-400  | è¶…å„ªè‰¯æŠ•è³‡     |
| ğŸ¥ˆ Silver Tier | 201 å†† ã€œ 500 å††  | ğŸ¥ˆ     | gray-300    | æ˜ ç”»é¤¨ã‚ˆã‚Šå®‰ã„ |
| ğŸ¥‰ Bronze Tier | 501 å†† ã€œ 1500 å†† | ğŸ¥‰     | orange-400  | é©æ­£ä¾¡æ ¼       |
| ğŸ’¸ Luxury      | 1501 å††ã€œ         | ğŸ’¸     | pink-400    | è´…æ²¢ãªéŠã³     |
| ğŸ Free        | ã‚µãƒ–ã‚¹ã‚¯/ç„¡æ–™     | ğŸ     | green-400   | ã‚µãƒ–ã‚¹ã‚¯/ç„¡æ–™  |
| ğŸ“š Unplayed    | æœªãƒ—ãƒ¬ã‚¤          | ğŸ“š     | gray        | æœªãƒ—ãƒ¬ã‚¤       |

## ä¾å­˜é–¢ä¿‚

- #16 DBãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³
- #17 èªè¨¼UIå®Ÿè£…
- #19 ãƒãƒ¼ãƒˆãƒ•ã‚©ãƒªã‚ªç™»éŒ²æ©Ÿèƒ½

## å—ã‘å…¥ã‚Œæ¡ä»¶

- [ ] `/dashboard` ã«ã‚¢ã‚¯ã‚»ã‚¹ã§ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ãŒè¡¨ç¤ºã•ã‚Œã‚‹
- [ ] æœªãƒ­ã‚°ã‚¤ãƒ³æ™‚ã¯ãƒ­ã‚°ã‚¤ãƒ³ãƒšãƒ¼ã‚¸ã«ãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆ
- [ ] ã‚µãƒãƒªãƒ¼ã«ç·æŠ•è³‡é¡ã€ç·ãƒ—ãƒ¬ã‚¤æ™‚é–“ã€å¹³å‡CPHãŒè¡¨ç¤ºã•ã‚Œã‚‹
- [ ] å¹³å‡CPHã«å¿œã˜ãŸãƒ©ãƒ³ã‚¯ãƒãƒƒã‚¸ãŒè¡¨ç¤ºã•ã‚Œã‚‹
- [ ] ç™»éŒ²ã‚²ãƒ¼ãƒ ä¸€è¦§ãŒè¡¨ç¤ºã•ã‚Œã‚‹
- [ ] å„ã‚²ãƒ¼ãƒ ã«CPHã€ãƒ—ãƒ¬ã‚¤æ™‚é–“ã€é‡‘é¡ã€ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ãŒè¡¨ç¤ºã•ã‚Œã‚‹
- [ ] ã€Œ+ ã‚²ãƒ¼ãƒ ã‚’ç™»éŒ²ã€ãƒœã‚¿ãƒ³ãŒæ©Ÿèƒ½ã™ã‚‹
- [ ] ãƒ¢ãƒã‚¤ãƒ«è¡¨ç¤ºã§ã‚‚é©åˆ‡ã«ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆã•ã‚Œã‚‹

## ãƒ‡ã‚¶ã‚¤ãƒ³ä»•æ§˜

- ã‚µãƒãƒªãƒ¼ã‚«ãƒ¼ãƒ‰: 3åˆ—ã‚°ãƒªãƒƒãƒ‰ï¼ˆãƒ¢ãƒã‚¤ãƒ«ã¯1åˆ—ï¼‰
- ã‚²ãƒ¼ãƒ ãƒªã‚¹ãƒˆ: ã‚«ãƒ¼ãƒ‰å½¢å¼ã§ç¸¦ã«ä¸¦ã¹ã‚‹
- ãƒ©ãƒ³ã‚¯ãƒãƒƒã‚¸: çµµæ–‡å­— + ã‚«ãƒ©ãƒ¼ã§è¦–è¦šçš„ã«åŒºåˆ¥
- å…¨ä½“: ãƒ€ãƒ¼ã‚¯ãƒ†ãƒ¼ãƒã«çµ±ä¸€

## é–¢é€£ãƒã‚±ãƒƒãƒˆ

- #19 ãƒãƒ¼ãƒˆãƒ•ã‚©ãƒªã‚ªç™»éŒ²æ©Ÿèƒ½
- #21 ç·¨é›†å‰Šé™¤æ©Ÿèƒ½
