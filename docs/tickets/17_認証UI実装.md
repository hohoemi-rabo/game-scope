# ãƒã‚±ãƒƒãƒˆ #17: èªè¨¼UIå®Ÿè£…

## ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹: [æœªç€æ‰‹]

## æ¦‚è¦

ãƒ˜ãƒƒãƒ€ãƒ¼ã«ãƒ­ã‚°ã‚¤ãƒ³ãƒœã‚¿ãƒ³ã¨ãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒ¡ãƒ‹ãƒ¥ãƒ¼ï¼ˆãƒ‰ãƒ­ãƒƒãƒ—ãƒ€ã‚¦ãƒ³ï¼‰ã‚’å®Ÿè£…ã™ã‚‹ã€‚

## èƒŒæ™¯

- ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒGoogleã§ãƒ­ã‚°ã‚¤ãƒ³/ãƒ­ã‚°ã‚¢ã‚¦ãƒˆã§ãã‚‹UIãŒå¿…è¦
- æœªãƒ­ã‚°ã‚¤ãƒ³æ™‚: ãƒ­ã‚°ã‚¤ãƒ³ãƒœã‚¿ãƒ³ã‚’è¡¨ç¤º
- ãƒ­ã‚°ã‚¤ãƒ³æ¸ˆã¿æ™‚: ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚¢ã‚¤ã‚³ãƒ³ã¨ãƒ‰ãƒ­ãƒƒãƒ—ãƒ€ã‚¦ãƒ³ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã‚’è¡¨ç¤º
- æ—¢å­˜ã®ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³æ§‹é€ ã‚’ç¶­æŒã—ã¤ã¤æ‹¡å¼µ

## ä½œæ¥­å†…å®¹

### 1. èªè¨¼çŠ¶æ…‹ç®¡ç†

- [ ] èªè¨¼ã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆ/ãƒ•ãƒƒã‚¯ã®ä½œæˆ
- [ ] ã‚»ãƒƒã‚·ãƒ§ãƒ³çŠ¶æ…‹ã®ç›£è¦–
- [ ] ãƒ­ã‚°ã‚¤ãƒ³/ãƒ­ã‚°ã‚¢ã‚¦ãƒˆé–¢æ•°ã®å®Ÿè£…

### 2. ãƒ˜ãƒƒãƒ€ãƒ¼ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆæ‹¡å¼µ

- [ ] æœªãƒ­ã‚°ã‚¤ãƒ³æ™‚ã®ãƒ­ã‚°ã‚¤ãƒ³ãƒœã‚¿ãƒ³è¿½åŠ 
- [ ] ãƒ­ã‚°ã‚¤ãƒ³æ¸ˆã¿æ™‚ã®ãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒ¡ãƒ‹ãƒ¥ãƒ¼è¿½åŠ 
- [ ] ãƒ‰ãƒ­ãƒƒãƒ—ãƒ€ã‚¦ãƒ³ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã®å®Ÿè£…

### 3. èªè¨¼ã‚³ãƒ¼ãƒ«ãƒãƒƒã‚¯ãƒšãƒ¼ã‚¸

- [ ] `/auth/callback` ãƒ«ãƒ¼ãƒˆã®ä½œæˆ
- [ ] OAuthèªè¨¼å®Œäº†å¾Œã®ãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆå‡¦ç†

## æŠ€è¡“ä»•æ§˜

### ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³è¡¨ç¤ºä»•æ§˜

**æœªãƒ­ã‚°ã‚¤ãƒ³æ™‚**
```
ğŸ†é«˜è©•ä¾¡ | ğŸ”æ¤œç´¢ | ğŸ“°ãƒ‹ãƒ¥ãƒ¼ã‚¹ | ğŸ”„æ›´æ–°çŠ¶æ³ | [ãƒ­ã‚°ã‚¤ãƒ³]
```

**ãƒ­ã‚°ã‚¤ãƒ³æ¸ˆã¿æ™‚**
```
ğŸ†é«˜è©•ä¾¡ | ğŸ”æ¤œç´¢ | ğŸ“°ãƒ‹ãƒ¥ãƒ¼ã‚¹ | ğŸ”„æ›´æ–°çŠ¶æ³ | [ğŸ‘¤ â–¼]
                                              â”œâ”€ ğŸ“Š ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰
                                              â”œâ”€ âš™ï¸ è¨­å®š
                                              â””â”€ ãƒ­ã‚°ã‚¢ã‚¦ãƒˆ
```

### ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆæ§‹æˆ

```
src/app/components/
â”œâ”€â”€ Header.tsx          # æ—¢å­˜ï¼ˆæ‹¡å¼µï¼‰
â”œâ”€â”€ auth/
â”‚   â”œâ”€â”€ LoginButton.tsx     # ãƒ­ã‚°ã‚¤ãƒ³ãƒœã‚¿ãƒ³
â”‚   â”œâ”€â”€ UserMenu.tsx        # ãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒ¡ãƒ‹ãƒ¥ãƒ¼ï¼ˆãƒ‰ãƒ­ãƒƒãƒ—ãƒ€ã‚¦ãƒ³ï¼‰
â”‚   â””â”€â”€ AuthProvider.tsx    # èªè¨¼ã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆï¼ˆä»»æ„ï¼‰
```

### LoginButton.tsx

```typescript
'use client'

import { createClient } from '@/lib/supabase/client'

export default function LoginButton() {
  const handleLogin = async () => {
    const supabase = createClient()

    await supabase.auth.signInWithOAuth({
      provider: 'google',
      options: {
        redirectTo: `${window.location.origin}/auth/callback`,
      },
    })
  }

  return (
    <button
      onClick={handleLogin}
      className="flex items-center gap-2 px-4 py-2 rounded-lg
                 bg-accent text-white hover:bg-accent/80
                 transition-colors font-medium"
    >
      <svg className="w-5 h-5" viewBox="0 0 24 24">
        {/* Google icon */}
      </svg>
      <span className="hidden md:inline">ãƒ­ã‚°ã‚¤ãƒ³</span>
    </button>
  )
}
```

### UserMenu.tsx

```typescript
'use client'

import { useState, useRef, useEffect } from 'react'
import Link from 'next/link'
import { createClient } from '@/lib/supabase/client'
import type { User } from '@supabase/supabase-js'

interface UserMenuProps {
  user: User
}

export default function UserMenu({ user }: UserMenuProps) {
  const [isOpen, setIsOpen] = useState(false)
  const menuRef = useRef<HTMLDivElement>(null)

  // å¤–éƒ¨ã‚¯ãƒªãƒƒã‚¯ã§é–‰ã˜ã‚‹
  useEffect(() => {
    const handleClickOutside = (event: MouseEvent) => {
      if (menuRef.current && !menuRef.current.contains(event.target as Node)) {
        setIsOpen(false)
      }
    }
    document.addEventListener('mousedown', handleClickOutside)
    return () => document.removeEventListener('mousedown', handleClickOutside)
  }, [])

  const handleLogout = async () => {
    const supabase = createClient()
    await supabase.auth.signOut()
    window.location.href = '/'
  }

  return (
    <div className="relative" ref={menuRef}>
      {/* ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚¢ã‚¤ã‚³ãƒ³ãƒœã‚¿ãƒ³ */}
      <button
        onClick={() => setIsOpen(!isOpen)}
        className="flex items-center gap-2 px-3 py-2 rounded-lg
                   text-text-secondary hover:text-text-primary
                   hover:bg-gray-800 transition-colors"
      >
        {user.user_metadata?.avatar_url ? (
          <img
            src={user.user_metadata.avatar_url}
            alt="User"
            className="w-8 h-8 rounded-full"
          />
        ) : (
          <div className="w-8 h-8 rounded-full bg-accent flex items-center justify-center">
            <span className="text-white text-sm">
              {user.email?.charAt(0).toUpperCase()}
            </span>
          </div>
        )}
        <svg
          className={`w-4 h-4 transition-transform ${isOpen ? 'rotate-180' : ''}`}
          fill="none"
          stroke="currentColor"
          viewBox="0 0 24 24"
        >
          <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M19 9l-7 7-7-7" />
        </svg>
      </button>

      {/* ãƒ‰ãƒ­ãƒƒãƒ—ãƒ€ã‚¦ãƒ³ãƒ¡ãƒ‹ãƒ¥ãƒ¼ */}
      {isOpen && (
        <div className="absolute right-0 mt-2 w-48 bg-gray-900 border border-gray-700
                        rounded-lg shadow-lg py-2 z-50">
          <Link
            href="/dashboard"
            className="flex items-center gap-2 px-4 py-2 text-text-secondary
                       hover:text-text-primary hover:bg-gray-800 transition-colors"
            onClick={() => setIsOpen(false)}
          >
            <span>ğŸ“Š</span>
            <span>ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰</span>
          </Link>
          <Link
            href="/settings"
            className="flex items-center gap-2 px-4 py-2 text-text-secondary
                       hover:text-text-primary hover:bg-gray-800 transition-colors"
            onClick={() => setIsOpen(false)}
          >
            <span>âš™ï¸</span>
            <span>è¨­å®š</span>
          </Link>
          <hr className="my-2 border-gray-700" />
          <button
            onClick={handleLogout}
            className="w-full flex items-center gap-2 px-4 py-2 text-text-secondary
                       hover:text-danger hover:bg-gray-800 transition-colors"
          >
            <span>ğŸšª</span>
            <span>ãƒ­ã‚°ã‚¢ã‚¦ãƒˆ</span>
          </button>
        </div>
      )}
    </div>
  )
}
```

### èªè¨¼ã‚³ãƒ¼ãƒ«ãƒãƒƒã‚¯

```typescript
// src/app/auth/callback/route.ts
import { createClient } from '@/lib/supabase/server'
import { NextResponse } from 'next/server'

export async function GET(request: Request) {
  const { searchParams, origin } = new URL(request.url)
  const code = searchParams.get('code')
  const next = searchParams.get('next') ?? '/dashboard'

  if (code) {
    const supabase = createClient()
    const { error } = await supabase.auth.exchangeCodeForSession(code)

    if (!error) {
      return NextResponse.redirect(`${origin}${next}`)
    }
  }

  // ã‚¨ãƒ©ãƒ¼æ™‚ã¯ãƒˆãƒƒãƒ—ãƒšãƒ¼ã‚¸ã¸
  return NextResponse.redirect(`${origin}/?error=auth`)
}
```

### Header.tsx ã®æ‹¡å¼µ

```typescript
// ãƒ˜ãƒƒãƒ€ãƒ¼ã§ã®ãƒ¦ãƒ¼ã‚¶ãƒ¼çŠ¶æ…‹å–å¾—
import { createClient } from '@/lib/supabase/server'

export default async function Header() {
  const supabase = createClient()
  const { data: { user } } = await supabase.auth.getUser()

  return (
    <header>
      {/* æ—¢å­˜ã®ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³ */}

      {/* èªè¨¼éƒ¨åˆ† */}
      <div className="flex items-center gap-2">
        {user ? (
          <UserMenu user={user} />
        ) : (
          <LoginButton />
        )}
      </div>
    </header>
  )
}
```

## ä¾å­˜é–¢ä¿‚

- #15 Googleèªè¨¼ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—

## å—ã‘å…¥ã‚Œæ¡ä»¶

- [ ] æœªãƒ­ã‚°ã‚¤ãƒ³æ™‚ã«ãƒ­ã‚°ã‚¤ãƒ³ãƒœã‚¿ãƒ³ãŒè¡¨ç¤ºã•ã‚Œã‚‹
- [ ] ãƒ­ã‚°ã‚¤ãƒ³ãƒœã‚¿ãƒ³ã‚¯ãƒªãƒƒã‚¯ã§Google OAuthç”»é¢ã«é·ç§»ã™ã‚‹
- [ ] èªè¨¼æˆåŠŸå¾Œã€ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ã«ãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆã•ã‚Œã‚‹
- [ ] ãƒ­ã‚°ã‚¤ãƒ³æ¸ˆã¿æ™‚ã«ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚¢ã‚¤ã‚³ãƒ³ã¨ãƒ‰ãƒ­ãƒƒãƒ—ãƒ€ã‚¦ãƒ³ãŒè¡¨ç¤ºã•ã‚Œã‚‹
- [ ] ãƒ‰ãƒ­ãƒƒãƒ—ãƒ€ã‚¦ãƒ³ã‹ã‚‰ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ã€è¨­å®šã€ãƒ­ã‚°ã‚¢ã‚¦ãƒˆã«ã‚¢ã‚¯ã‚»ã‚¹ã§ãã‚‹
- [ ] ãƒ­ã‚°ã‚¢ã‚¦ãƒˆå¾Œã€ãƒˆãƒƒãƒ—ãƒšãƒ¼ã‚¸ã«ãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆã•ã‚Œã‚‹
- [ ] ãƒ¢ãƒã‚¤ãƒ«è¡¨ç¤ºã§ã‚‚é©åˆ‡ã«ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆã•ã‚Œã‚‹

## ãƒ‡ã‚¶ã‚¤ãƒ³ä»•æ§˜

- ãƒ­ã‚°ã‚¤ãƒ³ãƒœã‚¿ãƒ³: ã‚¢ã‚¯ã‚»ãƒ³ãƒˆã‚«ãƒ©ãƒ¼èƒŒæ™¯
- ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚¢ã‚¤ã‚³ãƒ³: Googleãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«ç”»åƒ or ã‚¤ãƒ‹ã‚·ãƒ£ãƒ«
- ãƒ‰ãƒ­ãƒƒãƒ—ãƒ€ã‚¦ãƒ³: ãƒ€ãƒ¼ã‚¯ãƒ†ãƒ¼ãƒã«åˆã‚ã›ãŸãƒ‡ã‚¶ã‚¤ãƒ³
- ãƒ›ãƒãƒ¼æ™‚ã®ãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯ã‚’å¿˜ã‚Œãšã«

## é–¢é€£ãƒã‚±ãƒƒãƒˆ

- #15 Googleèªè¨¼ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—
- #20 ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰UI
