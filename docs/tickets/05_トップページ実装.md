# 05_トップページ実装

**ステータス**: [完了]
**優先度**: 高
**Phase**: Phase 1 (MVP)

## 概要

GameScope のトップページ（高評価ゲーム一覧）を実装する。Server Components を使用してデータを取得し、ゲームカードを表示。

## 目的

- 高評価ゲーム一覧の表示
- サーバーサイドデータフェッチングの実装
- メタデータの設定（SEO対応）
- ローディング状態の実装

## タスク一覧

### 1. ページコンポーネント実装
- [x] `app/page.tsx` の実装
- [x] Server Component としてデータフェッチング
- [x] エラーハンドリングの実装

### 2. メタデータ設定
- [x] ページタイトルの設定
- [x] description メタタグの設定
- [ ] OGP 画像の設定（Phase 2）

### 3. レイアウト更新
- [x] `app/layout.tsx` の更新
- [x] ヘッダーコンポーネントの追加
- [x] フッターコンポーネントの追加

### 4. ローディング・エラー UI
- [x] `app/loading.tsx` の作成
- [x] `app/error.tsx` の作成

### 5. パフォーマンス最適化
- [x] ISR の設定（revalidate）
- [x] Suspense によるストリーミング

## 実装詳細

### app/page.tsx

```typescript
import { getTopGames } from '@/lib/supabase/server'
import Container from './components/Container'
import GameGrid from './components/GameGrid'
import type { Metadata } from 'next'

// メタデータの設定
export const metadata: Metadata = {
  title: 'GameScope - 日本語で話題のゲームがわかる',
  description: '海外ゲームの評価を日本語でわかりやすく。高評価ゲーム、発売予定、配信情報を一目で確認。',
}

// 1時間ごとに再検証（ISR）
export const revalidate = 3600

/**
 * トップページ
 * 高評価ゲーム一覧を表示
 */
export default async function HomePage() {
  try {
    // Server Component で直接データフェッチング
    const games = await getTopGames(20)

    return (
      <Container className="py-8">
        <header className="mb-8">
          <h1 className="text-4xl md:text-5xl font-bold mb-2">
            高評価ゲーム
          </h1>
          <p className="text-text-secondary text-lg">
            メタスコア順に並んでいます
          </p>
        </header>

        <GameGrid games={games} />
      </Container>
    )
  } catch (error) {
    console.error('Failed to load games:', error)
    throw error // error.tsx でキャッチされる
  }
}
```

### app/layout.tsx の更新

```typescript
import type { Metadata } from "next";
import { Geist, Geist_Mono } from "next/font/google";
import "./globals.css";
import Header from "./components/Header";
import Footer from "./components/Footer";

const geistSans = Geist({
  variable: "--font-geist-sans",
  subsets: ["latin"],
});

const geistMono = Geist_Mono({
  variable: "--font-geist-mono",
  subsets: ["latin"],
});

export const metadata: Metadata = {
  title: {
    default: "GameScope",
    template: "%s | GameScope",
  },
  description: "日本語で話題のゲームの評判と雰囲気が3秒でわかる",
};

export default function RootLayout({
  children,
}: Readonly<{
  children: React.ReactNode;
}>) {
  return (
    <html lang="ja">
      <body
        className={`${geistSans.variable} ${geistMono.variable} antialiased`}
      >
        <div className="min-h-screen flex flex-col">
          <Header />
          <main className="flex-grow">
            {children}
          </main>
          <Footer />
        </div>
      </body>
    </html>
  );
}
```

### app/components/Header.tsx

```typescript
import Link from 'next/link'
import Container from './Container'

export default function Header() {
  return (
    <header className="border-b border-gray-800 bg-bg-primary/80 backdrop-blur-sm sticky top-0 z-50">
      <Container>
        <div className="flex items-center justify-between h-16">
          {/* ロゴ */}
          <Link href="/" className="flex items-center gap-2">
            <div className="text-2xl font-bold">
              <span className="text-accent">Game</span>
              <span className="text-text-primary">Scope</span>
            </div>
          </Link>

          {/* ナビゲーション */}
          <nav className="flex items-center gap-6">
            <Link
              href="/"
              className="text-text-secondary hover:text-text-primary transition-colors"
            >
              高評価
            </Link>
            {/* Phase 2 で追加 */}
            {/* <Link href="/releases">発売予定</Link> */}
          </nav>
        </div>
      </Container>
    </header>
  )
}
```

### app/components/Footer.tsx

```typescript
import Container from './Container'

export default function Footer() {
  const currentYear = new Date().getFullYear()

  return (
    <footer className="border-t border-gray-800 bg-bg-primary mt-auto">
      <Container>
        <div className="py-8 flex flex-col md:flex-row items-center justify-between gap-4">
          <div className="text-text-secondary text-sm">
            © {currentYear} GameScope. All rights reserved.
          </div>

          <div className="flex gap-4 text-sm text-text-secondary">
            <a
              href="https://opencritic.com"
              target="_blank"
              rel="noopener noreferrer"
              className="hover:text-text-primary transition-colors"
            >
              Powered by OpenCritic
            </a>
          </div>
        </div>
      </Container>
    </footer>
  )
}
```

### app/loading.tsx

```typescript
import Container from './components/Container'
import LoadingSpinner from './components/LoadingSpinner'

/**
 * ページ全体のローディング状態
 * Suspense の fallback として使用される
 */
export default function Loading() {
  return (
    <Container className="py-8">
      <div className="flex flex-col items-center justify-center min-h-[400px]">
        <LoadingSpinner size="lg" />
        <p className="mt-4 text-text-secondary">読み込み中...</p>
      </div>
    </Container>
  )
}
```

### app/error.tsx

```typescript
'use client'

import { useEffect } from 'react'
import Container from './components/Container'

/**
 * エラー境界コンポーネント
 * ページレベルのエラーをキャッチ
 */
export default function Error({
  error,
  reset,
}: {
  error: Error & { digest?: string }
  reset: () => void
}) {
  useEffect(() => {
    console.error('Page error:', error)
  }, [error])

  return (
    <Container className="py-8">
      <div className="flex flex-col items-center justify-center min-h-[400px] text-center">
        <h2 className="text-2xl font-bold text-danger mb-4">
          エラーが発生しました
        </h2>
        <p className="text-text-secondary mb-6">
          ページの読み込みに失敗しました。
        </p>
        <button
          onClick={reset}
          className="px-6 py-3 bg-accent hover:bg-accent/80
                     text-white rounded-lg transition-colors"
        >
          再試行
        </button>
      </div>
    </Container>
  )
}
```

## 完了条件

- [x] トップページが正しく表示される
- [x] 高評価ゲームが20件表示される
- [x] ヘッダーとフッターが表示される
- [x] ローディング状態が表示される
- [x] エラーハンドリングが機能する
- [x] ISR（1時間ごと再検証）が設定されている
- [x] レスポンシブデザインが機能している

## 関連チケット

- 前: `04_ゲームカードコンポーネント.md`
- 次: `06_ゲーム詳細ページ実装.md`

## 参考資料

- [Next.js Pages](https://nextjs.org/docs/app/building-your-application/routing/pages)
- [Next.js Metadata](https://nextjs.org/docs/app/api-reference/functions/generate-metadata)
- [Next.js Error Handling](https://nextjs.org/docs/app/building-your-application/routing/error-handling)
